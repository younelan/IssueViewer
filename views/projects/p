<?php

$workflowXml = '<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE workflow PUBLIC "-//OpenSymphony Group//DTD OSWorkflow 2.8//EN" "http://www.opensymphony.com/osworkflow/workflow_2_8.dtd">
<workflow>
  <meta name="jira.description">Generated by JIRA Software version 7.3.0-DAILY20170302150106. This workflow is managed internally by JIRA Software. Do not manually modify this workflow.</meta>
  <meta name="jira.update.author.key">youness</meta>
  <meta name="jira.updated.date">1493902228380</meta>
  <meta name="jira.update.author.name">admin</meta>
  <meta name="gh.version">7.3.0-DAILY20170302150106</meta>
  <initial-actions>
    <action id="1" name="Create">
      <meta name="jira.i18n.title">common.forms.create</meta>
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="null" status="Backlog" step="11">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction
                            </arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <global-actions>
    <action id="11" name="To Do">
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.title">gh.workflow.preset.todo</meta>
      <results>
        <unconditional-result old-status="Not Done" status="Done" step="11">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">
                                com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction
                            </arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="21" name="In Progress">
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.title">gh.workflow.preset.inprogress</meta>
      <results>
        <unconditional-result old-status="Not Done" status="Done" step="22">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">
                                com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction
                            </arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="31" name="In Review">
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.title">gh.workflow.preset.inreview</meta>
      <results>
        <unconditional-result old-status="Not Done" status="Done" step="33">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">
                                com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction
                            </arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="41" name="Done">
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.title">gh.workflow.preset.done</meta>
      <results>
        <unconditional-result old-status="Not Done" status="Done" step="44">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="field.value">10000</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">
                                com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction
                            </arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction
                            </arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </global-actions>
  <steps>
    <step id="11" name="To Do">
      <meta name="jira.status.id">10000</meta>
    </step>
    <step id="22" name="In Progress">
      <meta name="jira.status.id">3</meta>
    </step>
    <step id="33" name="In Review">
      <meta name="jira.status.id">10100</meta>
    </step>
    <step id="44" name="Done">
      <meta name="jira.status.id">10001</meta>
    </step>
  </steps>
</workflow>
';


// 1. Load the XML:
$xml = simplexml_load_string($workflowXml);

if ($xml === false) {
    echo "Failed to parse XML.\n";
    exit;
}


// 2. Accessing meta information:
echo "Description: " . $xml->meta[0] . "\n"; // Accessing the first meta element. If you have multiple, you'll need to loop.
echo "Update Author: " . $xml->meta[1] . "\n";
echo "Updated Date: " . $xml->meta[2] . "\n";


// 3. Accessing initial actions:
echo "\nInitial Action:\n";
foreach ($xml->{'initial-actions'}->action as $action) {
    echo "  ID: " . $action['id'] . "\n";
    echo "  Name: " . $action['name'] . "\n";
    // ... access validators, results, post-functions in a similar manner
    echo "  Validators: \n";
    foreach ($action->validators->validator as $validator) {
        echo "    Class: " . $validator->{'arg'}[1] . "\n";
    }

    echo "  Results: \n";
    foreach ($action->results->{'unconditional-result'} as $result) {
        echo "    Status: " . $result['status'] . "\n";
        echo "    Post Functions: \n";
        foreach ($result->{'post-functions'}->function as $function) {
            echo "      Class: " . $function->{'arg'}[1] . "\n";
        }
    }

}


// 4. Accessing steps and actions within steps:
echo "\nSteps:\n";
foreach ($xml->steps->step as $step) {
    echo "  ID: " . $step['id'] . "\n";
    echo "  Name: " . $step['name'] . "\n";
    echo "  Status ID: " . $step->meta[0] . "\n"; // Access meta elements as needed
    echo "  Actions:\n";
    foreach ($step->actions->action ?? [] as $action) {
        echo "    ID: " . $action['id'] . "\n";
        echo "    Name: " . $action['name'] . "\n";
        // ... access restrict-to, conditions, results, post-functions as needed
    }
}



?>
